<!DOCTYPE html>
<html>
<head>
    <title>Zoho Scraper</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <script>
        function buttonBlock() {
            const url = document.querySelector('input[name="url"]').value.trim();
            const depthChecked = document.querySelector('input[name="depth"]:checked');
            const submitButton = document.getElementById("submit-button");

            const isUrlFilled = url.length > 0;
            const isDepthSelected = depthChecked !== null;
            submitButton.disabled = !(isUrlFilled && isDepthSelected);

            console.log("URL filled:", isUrlFilled, "Depth selected:", isDepthSelected, "Button disabled:", submitButton.disabled);
        }

        function showLoading(event) {
            event.preventDefault(); // Prevent default form submission
            document.getElementById("submit-button").style.display = "none";
            document.getElementById("loading").style.display = "block";
            document.forms[0].submit(); // Manually submit the form
        }

        window.onload = function () {
            document.getElementById("submit-button").style.display = "inline-block";
            document.getElementById("loading").style.display = "none";

            const urlInput = document.querySelector('input[name="url"]');
            const depthRadios = document.querySelectorAll('input[name="depth"]');

            urlInput.addEventListener('input', buttonBlock);
            depthRadios.forEach(radio => radio.addEventListener('change', buttonBlock));

            buttonBlock();
        }
    </script>
</head>
<body>
<h1>Zoho Scraper</h1>

<form method="POST" action="/scrape" onsubmit="showLoading(event)">
    <label>Start URL:</label><br>
    <input type="text" name="url" value="{{ url or '' }}"><br><br>

    <label>Depth:</label><br>
    <input type="radio" name="depth" value="0" {% if depth == 0 %}checked{% endif %}> Fast (only first page)<br>
    <input type="radio" name="depth" value="1" {% if depth == 1 %}checked{% endif %}> Medium (first nesting)<br>
    <input type="radio" name="depth" value="2" {% if depth == 2 or depth is none %}checked{% endif %}> Slow (to the second nesting)<br>
    <input type="radio" name="depth" value="3" {% if depth == 3 %}checked{% endif %}> Very slow (to the third nesting)<br><br>

    <button type="submit" id="submit-button" disabled>Start Scraping</button>
</form>

<p id="loading" style="display:none;">Parsing... Please, wait ðŸŒ€</p>
{% if error %}
    <p class="error">{{ error }}</p>
{% endif %}
</body>
</html>